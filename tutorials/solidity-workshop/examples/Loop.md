# Loop

A (contrived) contract that reads the first 32 bytes of calldata and treats it as a 256 bit unsigned integer (`n`), creates an index (`i = 0`) and increments it by 1 for as long as `i < n`. For each increment it will also add 5 to a number (`x = 0`):

```
var x = 0;
for(uint256 i = 0; i < n; i++)
    x += 5;
return x;
```

### Procedure

1. Read the number (`n`) from calldata, put on stack.

2. Push 0 to stack twice (`i` and `x`)

// Loop (JUMPDEST)

3. Duplicate `n` and `i` (item 2 and 1) and do LT comparison. Note that since `DUP1` duplicates item 0, and we want 2, we need to use `DUP3`, and since that adds another item, we need to call it again when getting `i` since it has become item 2.

4. Push jumpdest for body and do conditional jump.

// Finalize

5. Mstore to address 0.

6. Push 0 to stack.

7. Return.

// Loop body (JUMPDEST)

8. Push 5 to stack and add. (this adds 5 to `x`)

9. Swap, push 1 to stack and add. (this adds 1 to `i`)

10. Swap again to reset, push jumpdest for loop and jump.



### Implementation

1. `PUSH1 0x00 CALLDATALOAD`

2. `PUSH1 0x00 PUSH1 0x00`

// Loop

3. `JUMPDEST DUP3 DUP3 LT`

4. `PUSH 0x16 JUMPI`

// Finalize

4. `JUMPDEST PUSH1 0x00 MSTORE`

5. `PUSH1 0x20 PUSH1 0x00 RETURN`

// Loop body

5. `PUSH1 0x05 ADD`

6. `SWAP1 PUSH1 0x01 ADD`

7. `SWAP1 PUSH1 0x07 JUMP` 

Complete:

`PUSH1 0x00 CALLDATALOAD PUSH1 0x00 PUSH1 0x00 JUMPDEST DUP3 DUP3 LT PUSH1 0x16 JUMPI PUSH1 0x00 MSTORE PUSH1 0x20 PUSH1 0x00 RETURN JUMPDEST PUSH1 0x05 ADD SWAP1 PUSH1 0x01 ADD SWAP1 PUSH1 0x07 JUMP`

Bytecode:

`600035600060005B82821060165760005260206000F35B6005019060010190600756`

Calldata: 7 (`0000000000000000000000000000000000000000000000000000000000000007`)

Expected: 35 (`0000000000000000000000000000000000000000000000000000000000000023`)

Result:

```
/usr/local/bin/node runcode.js
PC: 0
Opcode: PUSH1
Stack: []
Memory: []
PC: 2
Opcode: CALLDATALOAD
Stack: [ '00' ]
Memory: []
PC: 3
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 5
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '00' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '00',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '00',
  '05' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '00' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '00',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '01' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '01' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '05',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '01',
  '0A' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0A',
  '01' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0A',
  '01',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0A',
  '02' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '02' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0A',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '02',
  '0F' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0F',
  '02' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0F',
  '02',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '0F',
  '03' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '03' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '0F',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '03',
  '14' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '14',
  '03' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '14',
  '03',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '14',
  '04' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '04' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '14',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '04',
  '19' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '19',
  '04' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '19',
  '04',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '19',
  '05' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '05' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '19',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '05',
  '1E' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '1E',
  '05' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '1E',
  '05',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '1E',
  '06' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '06' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '01' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '01',
  '16' ]
Memory: []
PC: 22
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E' ]
Memory: []
PC: 23
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E' ]
Memory: []
PC: 25
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '1E',
  '05' ]
Memory: []
PC: 26
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '06',
  '23' ]
Memory: []
PC: 27
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '23',
  '06' ]
Memory: []
PC: 29
Opcode: ADD
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '23',
  '06',
  '01' ]
Memory: []
PC: 30
Opcode: SWAP1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '23',
  '07' ]
Memory: []
PC: 31
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23' ]
Memory: []
PC: 33
Opcode: JUMP
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '07' ]
Memory: []
PC: 7
Opcode: JUMPDEST
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23' ]
Memory: []
PC: 8
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23' ]
Memory: []
PC: 9
Opcode: DUP3
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '0000000000000000000000000000000000000000000000000000000000000007' ]
Memory: []
PC: 10
Opcode: LT
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '0000000000000000000000000000000000000000000000000000000000000007',
  '07' ]
Memory: []
PC: 11
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '00' ]
Memory: []
PC: 13
Opcode: JUMPI
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '00',
  '16' ]
Memory: []
PC: 14
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23' ]
Memory: []
PC: 16
Opcode: MSTORE
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '23',
  '00' ]
Memory: []
PC: 17
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07' ]
Memory: [00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,23]
PC: 19
Opcode: PUSH1
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '20' ]
Memory: [00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,23]
PC: 21
Opcode: RETURN
Stack: [ '0000000000000000000000000000000000000000000000000000000000000007',
  '07',
  '20',
  '00' ]
Memory: [00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,23]
returned:  0000000000000000000000000000000000000000000000000000000000000023

Process finished with exit code 0


```